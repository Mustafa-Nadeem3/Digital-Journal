<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- Logo Link -->
  <link rel="icon" href="/images/logo.png" />
  <title>Chronicle Keeper</title>
  <!-- Bootstrap CSS Link -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM" crossorigin="anonymous">
  <!-- Font Awesome Icons Link -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.1/css/all.min.css">
  <!-- Font Style Link -->
  <link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700&display=swap" rel="stylesheet">
  <!-- My CSS Link -->
  <link rel="stylesheet" href="styles.css">
</head>

<body>
  <!-- SideMenu Section -->
  <section id="side-menu">
    <div class="container">
      <div class="row">
        <div class="col-12">
          <h2 class="text-primary fw-bold text-center p-3" id="name"></h2>
          <div class="col-12 p-3 dashlink mb-2 shadow">
            <a href="/dashboard.html" class="text-decoration-none"><i
                class="fa-solid fa-book-open me-2"></i>Dashboard</a>
          </div>
          <div class="col-12 p-3 dashlink mb-2 shadow">
            <a href="/to-do.html" class="text-decoration-none"><i class="fa-solid fa-list-check me-2"></i>To-Do</a>
          </div>
          <div class="col-12 p-3 activelink mb-2 shadow">
            <a href="/journal.html" class="text-decoration-none"><i class="fa-solid fa-book me-2"></i>Journal</a>
          </div>
          <div class="col-12 p-3 dashlink mb-2 shadow">
            <a href="/password.html" class="text-decoration-none"><i class="fa-solid fa-lock me-2"></i>Password</a>
          </div>
          <div class="col-12 p-3 logoutlink shadow">
            <a href="/index.html" class="text-decoration-none"><i
                class="fa-solid fa-arrow-right-from-bracket me-2"></i>Close Book</a>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Dashboard Section -->
  <section id="dashboard">
    <div class="container journal">
      <div class="row mt-2">
        <div class="col-12 mobile_navbar">
          <div class="d-flex justify-content-start align-items-center">
            <h1 class="fw-bold text-primary me-3 pt-2">Journal</h1>
            <button class="bg-secondary border-3 border border-primary rounded-circle" type="button"
              data-bs-toggle="offcanvas" data-bs-target="#offcanvasExample" aria-controls="offcanvasExample">
              <i class="fa-solid fa-bars"></i>
            </button>
          </div>
          <div class="offcanvas offcanvas-start" tabindex="-1" id="offcanvasExample"
            aria-labelledby="offcanvasExampleLabel">
            <div class="offcanvas-header justify-content-end">
              <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
            </div>
            <div class="offcanvas-body">
              <div class="dropdown mt-3">
                <h2 class="text-primary fw-bold text-center p-3" id="name"></h2>
                <div class="col-12 p-3 dashlink mb-2 shadow">
                  <a href="/dashboard.html" class="text-decoration-none"><i
                      class="fa-solid fa-book-open me-2"></i>Dashboard</a>
                </div>
                <div class="col-12 p-3 dashlink mb-2 shadow">
                  <a href="/to-do.html" class="text-decoration-none"><i
                      class="fa-solid fa-list-check me-2"></i>To-Do</a>
                </div>
                <div class="col-12 p-3 activelink mb-2 shadow">
                  <a href="/journal.html" class="text-decoration-none"><i class="fa-solid fa-book me-2"></i>Journal</a>
                </div>
                <div class="col-12 p-3 dashlink mb-2 shadow">
                  <a href="/password.html" class="text-decoration-none"><i
                      class="fa-solid fa-lock me-2"></i>Password</a>
                </div>
                <div class="col-12 p-3 logoutlink shadow">
                  <a href="/index.html" class="text-decoration-none"><i
                      class="fa-solid fa-arrow-right-from-bracket me-2"></i>Close Book</a>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="col-12 d-flex justify-content-center align-items-center mobile-page">
          <div class="col-lg-6 col-sm-12 book page shadow">
            <div class="row left-page shadow">
              <div class="col-12 left-page-1 shadow text-center p-5">
                <form action="">
                  <div class="form-floating mb-3">
                    <textarea class="form-control" placeholder="Add a Task" id="log"></textarea>
                    <label for="log">How was your day?</label>
                  </div>
                  <div class="d-flex justify-content-center">
                    <button id="submit" type="submit"
                      class="border border-2 border-primary rounded-pill px-3 py-2 bg-secondary text-primary fw-bold">Add</button>
                  </div>
                </form>
              </div>
            </div>
          </div>
          <div class="col-lg-6 col-sm-12 book page shadow">
            <div class="row right-page shadow">
              <div class="col-12 right-page-1 shadow p-4 justify-content-center align-items-center journal-details overflow-y-scroll">

              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Bootstrap JS Link -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-geWF76RCwLtnZ8qwWowPQNguL3RmwHVBC9FhGdlKrxdiJJigb/j/68SIy3Te4Bkz"
    crossorigin="anonymous"></script>
  <!-- My JS Link -->
  <script type="module">
    // Import the functions you need from the SDKs you need
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.0.0/firebase-app.js"
    import { getDatabase, ref, set, push, get } from "https://www.gstatic.com/firebasejs/10.0.0/firebase-database.js"

    // For Firebase JS SDK v7.20.0 and later, measurementId is optional
    const firebaseConfig = {
      apiKey: "AIzaSyDMn2keSNKTwhA41-7ApI_iWckrLNJYvgM",
      authDomain: "chronicle-keeper-92380.firebaseapp.com",
      databaseURL: "https://chronicle-keeper-92380-default-rtdb.firebaseio.com",
      projectId: "chronicle-keeper-92380",
      storageBucket: "chronicle-keeper-92380.appspot.com",
      messagingSenderId: "830785207681",
      appId: "1:830785207681:web:0ae18b9db8f147ee5cfc80",
      measurementId: "G-WRH64WKX1W"
    }

    // Initialize Firebase
    const app = initializeApp(firebaseConfig)
    const db = getDatabase(app)

    document.getElementById("name").innerHTML = localStorage.getItem('currentUserName')

    const journalRef = ref(db, 'journal')
    const newJournalRef = push(journalRef)

    const date = new Date().toISOString()
    const year = date.slice(2, 4)
    const monthAndDay = date.slice(5, 10)
    const currentDate = year + "-" + monthAndDay

    document.getElementById("submit").addEventListener('click', function (e) {
      e.preventDefault()

      set(newJournalRef, {
        userId: localStorage.getItem('currentUserId'),
        start_date: currentDate,
        log: document.getElementById("log").value
      })
        .then(() => {
          alert("Log Successfully Add !")
          window.location.href = "/journal.html"
        })
        .catch((error) => {
          console.error("Error adding log: ", error)
        })
    })

    get(journalRef)
      .then((snapshot) => {
        if (snapshot.exists()) {
          const journalCount = Object.keys(snapshot.val()).length
          for (let i = 0; i < journalCount; i++) {
            const userId = Object.keys(snapshot.val())[i]
            const journalData = snapshot.val()[userId]

            if (localStorage.getItem('currentUserId') == journalData.userId) {
              const parentElement = document.querySelector('.journal-details')

              const containerDiv = document.createElement('div')
              containerDiv.classList.add('col-12', 'd-flex')

              const startDateDiv = document.createElement('div')
              startDateDiv.classList.add('col-lg-4', 'col-sm-12', 'd-flex')
              const startDateParagraph = document.createElement('p')
              startDateParagraph.classList.add('mb-0', 'fs-6', 'me-2')
              startDateParagraph.textContent = 'Date: '
              const startDateDataParagraph = document.createElement('p')
              startDateDataParagraph.classList.add('fs-6')
              startDateDataParagraph.textContent = journalData.start_date
              startDateDiv.appendChild(startDateParagraph)
              startDateDiv.appendChild(startDateDataParagraph)

              containerDiv.appendChild(startDateDiv)

              parentElement.appendChild(containerDiv)

              const logDiv = document.createElement('div')
              logDiv.classList.add('col-12')
              const logDataParagraph = document.createElement('p', 'journal-text')
              logDataParagraph.classList.add('fs-6', 'text-align-justify')
              logDataParagraph.textContent = journalData.log
              logDiv.appendChild(logDataParagraph)

              parentElement.appendChild(logDiv)
            }
          }
        } else {
          console.log("No data available")
        }
      })
      .catch((error) => {
        console.error("Error retrieving data:", error)
      })
  </script>
</body>

</html>